# 拡張 / コンテナ

Flightは拡張可能なフレームワークとして設計されています。フレームワークにはデフォルトのメソッドやコンポーネントが付属していますが、独自のメソッドをマッピングしたり、独自のクラスを登録したり、既存のクラスやメソッドを上書きすることが可能です。

## メソッドのマッピング

独自のカスタムメソッドをマッピングするには、`map` 関数を使用します：

```php
// 自分のメソッドをマップ
Flight::map('hello', function (string $name) {
  echo "hello $name!";
});

// カスタムメソッドを呼び出す
Flight::hello('Bob');
```

## クラスの登録 / コンテナ化

独自のクラスを登録するには、`register` 関数を使用します：

```php
// クラスを登録
Flight::register('user', User::class);

// クラスのインスタンスを取得する
$user = Flight::user();
```

この `register` メソッドは、クラスのコンストラクタにパラメータを渡すことも可能です。したがって、カスタムクラスをロードするときに、事前に初期化された状態で取得できます。追加の配列を渡すことでコンストラクタのパラメータを定義することができます。以下は、データベース接続をロードする例です：

```php
// コンストラクタパラメータを渡してクラスを登録
Flight::register('db', PDO::class, ['mysql:host=localhost;dbname=test', 'user', 'pass']);

// クラスのインスタンスを取得する
// これにより、定義されたパラメータを持つオブジェクトが作成されます
//
// new PDO('mysql:host=localhost;dbname=test','user','pass');
//
$db = Flight::db();
```

追加のコールバックパラメータを渡すと、クラスの構築後にすぐに実行されます。これにより、新しいオブジェクトのセットアップ手順を実行できます。コールバック関数は、新しいオブジェクトのインスタンスを含む1つのパラメータを取ります。

```php
// コンストラクトされたオブジェクトがコールバック関数に渡されます
Flight::register(
  'db',
  PDO::class,
  ['mysql:host=localhost;dbname=test', 'user', 'pass'],
  function (PDO $db) {
    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
  }
);
```

デフォルトでは、クラスをロードするたびに共有インスタンスが取得されます。新しいクラスのインスタンスを取得するには、単純にパラメータとして `false` を渡します：

```php
// クラスの共有インスタンス
$shared = Flight::db();

// クラスの新しいインスタンス
$new = Flight::db(false);
```

マッピングされたメソッドは登録されたクラスよりも優先されます。同じ名前で両方を宣言した場合は、マッピングされたメソッドのみが呼び出されます。