# Расширение / Контейнеры

Flight разработана как расширяемый фреймворк. В фреймворке поставляется набор
стандартных методов и компонентов, но вы можете отображать свои собственные методы,
регистрировать собственные классы или даже переопределять существующие классы и методы.

## Отображение методов

Чтобы отобразить ваш собственный простой пользовательский метод, используйте функцию `map`:

```php
// Отобразите свой метод
Flight::map('hello', function (string $name) {
  echo "привет $name!";
});

// Вызовите свой пользовательский метод
Flight::hello('Боб');
```

Это используется более тогда, когда вам нужно передать переменные в ваш метод, чтобы получить ожидаемое
значение. Использование метода `register()` как показано ниже используется в основном для передачи конфигурации
и затем вызова вашего предварительно сконфигурированного класса.

## Регистрация классов / Контейнеризация

Чтобы зарегистрировать свой собственный класс и сконфигурировать его, используйте функцию `register`:

```php
// Зарегистрируйте свой класс
Flight::register('user', User::class);

// Получите экземпляр вашего класса
$user = Flight::user();
```

Метод регистрации также позволяет передавать параметры в конструктор вашего класса.
Таким образом, при загрузке вашего пользовательского класса он будет предварительно инициализирован.
Вы можете определить параметры конструктора, передав дополнительный массив.
Вот пример загрузки подключения к базе данных:

```php
// Зарегистрируйте класс с параметрами конструктора
Flight::register('db', PDO::class, ['mysql:host=localhost;dbname=test', 'user', 'pass']);

// Получите экземпляр вашего класса
// Это создаст объект с определенными параметрами
//
// new PDO('mysql:host=localhost;dbname=test','user','pass');
//
$db = Flight::db();

// и если вам понадобится это позже в вашем коде, просто вызовите тот же метод снова
class SomeController {
  public function __construct() {
	$this->db = Flight::db();
  }
}
```

Если вы передаете дополнительный параметр обратного вызова, он будет немедленно выполнен
после построения класса. Это позволяет вам выполнить любые процедуры настройки для вашего
нового объекта. Функция обратного вызова принимает один параметр, экземпляр нового объекта.

```php
// Обратный вызов будет получать объект, который был построен
Flight::register(
  'db',
  PDO::class,
  ['mysql:host=localhost;dbname=test', 'user', 'pass'],
  function (PDO $db) {
    $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
  }
);
```

По умолчанию, каждый раз, когда вы загружаете свой класс, вы получите общий экземпляр.
Чтобы получить новый экземпляр класса, просто передайте `false` в качестве параметра:

```php
// Общий экземпляр класса
$shared = Flight::db();

// Новый экземпляр класса
$new = Flight::db(false);
```

Имейте в виду, что отображенные методы имеют приоритет над зарегистрированными классами. Если вы
объявите оба с использованием одного и того же имени, будет вызван только отображенный метод.

## Переопределение

Flight позволяет вам переопределять его стандартную функциональность, чтобы соответствовать вашим собственным потребностям,
не изменяя какой-либо код.

Например, когда Flight не может сопоставить URL с маршрутом, он вызывает метод `notFound`,
который отправляет общий ответ `HTTP 404`. Вы можете переопределить это поведение
с использованием метода `map`:

```php
Flight::map('notFound', function() {
  // Показать пользовательскую страницу 404
  include 'errors/404.html';
});
```

Flight также позволяет вам заменять основные компоненты фреймворка.
Например, вы можете заменить класс Router по умолчанию своим собственным пользовательским классом:

```php
// Зарегистрируйте ваш пользовательский класс
Flight::register('router', MyRouter::class);

// Когда Flight загружает экземпляр Router, будет загружен ваш класс
$myrouter = Flight::router();
```

Однако методы фреймворка, такие как `map` и `register`, не могут быть переопределены. Вы получите
ошибку, если попытаетесь это сделать.