# Ответы

Flight помогает генерировать часть заголовков ответа для вас, но большинство контроля за тем, что вы отправляете пользователю, остается в ваших руках. Иногда вы можете получить доступ к объекту `Response` напрямую, но большую часть времени вы будете использовать экземпляр `Flight` для отправки ответа.

## Отправка базового ответа

Flight использует `ob_start()`, чтобы буферизировать вывод. Это означает, что вы можете использовать `echo` или `print`, чтобы отправить ответ пользователю, и Flight захватит его и отправит обратно пользователю с соответствующими заголовками.

```php

// Это отправит "Привет, мир!" в браузер пользователя
Flight::route('/', function() {
	echo "Привет, мир!";
});

// HTTP/1.1 200 OK
// Content-Type: text/html
//
// Привет, мир!
```

Кроме того, вы можете вызвать метод `write()`, чтобы добавить информацию в тело также.

```php

// Это отправит "Привет, мир!" в браузер пользователя
Flight::route('/', function() {
	// подробно, но иногда помогает, когда это необходимо
	Flight::response()->write("Привет, мир!");

	// если вы хотите получить тело, которое вы установили на данный момент
	// вы можете сделать это вот так
	$body = Flight::response()->getBody();
});
```

## Коды статуса

Вы можете установить код статуса ответа, используя метод `status`:

```php
Flight::route('/@id', function($id) {
	if($id == 123) {
		Flight::response()->status(200);
		echo "Привет, мир!";
	} else {
		Flight::response()->status(403);
		echo "Запрещено";
	}
});
```

Если вы хотите получить текущий код статуса, вы можете использовать метод `status` без аргументов:

```php
Flight::response()->status(); // 200
```

## Установка заголовка ответа

Вы можете установить заголовок, такой как тип контента ответа, используя метод `header`:

```php

// Это отправит "Привет, мир!" в браузер пользователя в виде обычного текста
Flight::route('/', function() {
	Flight::response()->header('Content-Type', 'text/plain');
	echo "Привет, мир!";
});
```



## JSON

Flight поддерживает отправку ответов в формате JSON и JSONP. Чтобы отправить JSON-ответ, вы передаете некоторые данные для кодирования в JSON:

```php
Flight::json(['id' => 123]);
```

### JSONP

Для запросов JSONP вы можете опционально передать имя параметра запроса, которое используете для определения функции обратного вызова:

```php
Flight::jsonp(['id' => 123], 'q');
```

Таким образом, при выполнении GET-запроса с использованием `?q=my_func`, вы должны получить вывод:

```javascript
my_func({"id":123});
```

Если вы не передаете имя параметра запроса, оно будет по умолчанию `jsonp`.

## Перенаправление на другой URL

Вы можете перенаправить текущий запрос, используя метод `redirect()` и передавая новый URL:

```php
Flight::redirect('/new/location');
```

По умолчанию Flight отправляет код статуса HTTP 303 ("Смотри другое"). Вы можете опционально установить пользовательский код:

```php
Flight::redirect('/new/location', 401);
```

## Остановка

Вы можете остановить фреймворк в любой момент, вызвав метод `halt`:

```php
Flight::halt();
```

Вы также можете указать необязательный код статуса `HTTP` и сообщение:

```php
Flight::halt(200, 'Сейчас вернусь...');
```

Вызов `halt` сбросит весь содержимое ответа до этого момента. Если вы хотите остановить фреймворк и вывести текущий ответ, используйте метод `stop`:

```php
Flight::stop();
```

## HTTP-кэширование

Flight предоставляет встроенную поддержку кэширования на уровне HTTP. Если условие кэширования выполнено, Flight вернет ответ HTTP `304 Not Modified`. В следующий раз, когда клиент запросит тот же ресурс, ему будет предложено использовать версию, кэшированную локально.

### Кэширование на уровне маршрута

Если вы хотите кэшировать весь ваш ответ, вы можете использовать метод `cache()` и передать время кэширования.

```php

// Это закэширует ответ на 5 минут
Flight::route('/news', function () {
  Flight::cache(time() + 300);
  echo 'Этот контент будет кэширован.';
});

// Кроме того, вы можете использовать строку, которую вы бы передали
// методу strtotime()
Flight::route('/news', function () {
  Flight::cache('+5 minutes');
  echo 'Этот контент будет кэширован.';
});
```

### Последнее изменение

Вы можете использовать метод `lastModified` и передать UNIX-отметку времени, чтобы установить дату
и время последнего изменения страницы. Клиент будет продолжать использовать свой кэш до тех пор, пока
значение последнего изменения не изменится.

```php
Flight::route('/news', function () {
  Flight::lastModified(1234567890);
  echo 'Этот контент будет кэширован.';
});
```

### ETag

Кэширование `ETag` аналогично `Last-Modified`, за исключением того, что вы можете указать любой идентификатор
ресурса, который хотите:

```php
Flight::route('/news', function () {
  Flight::etag('my-unique-id');
  echo 'Этот контент будет кэширован.';
});
```

Имейте в виду, что вызов `lastModified` или `etag` установит и проверит значение кэша. Если значение кэша остается таким же между запросами, Flight немедленно отправит ответ `HTTP 304` и прекратит обработку.